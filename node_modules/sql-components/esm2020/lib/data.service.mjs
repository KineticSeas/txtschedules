import { Injectable, Inject } from '@angular/core';
import { BehaviorSubject, of } from 'rxjs';
import * as CryptoJS from 'crypto-js';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class SQLDataService {
    constructor(http, webserver) {
        this.http = http;
        this.webserver = webserver;
        this.dataSubject = new BehaviorSubject({});
        this.pageSubject = new BehaviorSubject({});
        this.paramSubject = new BehaviorSubject({ page: "AAA", id: "", id2: "", id3: "", id_col: "id", id2_col: "", id3_col: "" });
        this.routerSubject = new BehaviorSubject({});
        this.containerSubject = new BehaviorSubject({ id: "", id2: "", id3: "", id_col: "id", id2_col: "", id3_col: "" });
        this.dataValue = { id: "hello", id2: "world" };
        this.TheSecret = "hide-triggers";
        this.counter = 0;
        if (webserver === '' || webserver === undefined) {
            alert("Missing Provider in module.ts. It should include: { provide: WEBSERVER, useValue: 'https://example.com/api/' }");
        }
        else {
            this.base = webserver;
        }
        this.url = this.base + 'sqlcomponents.php';
    }
    getLocalStorage() {
        //
        if (localStorage.getItem('uid') === null) {
            this.uid = "0";
        }
        else {
            this.uid = localStorage.getItem('uid');
        }
        if (localStorage.getItem('un') === null) {
            this.un = "";
        }
        else {
            this.un = localStorage.getItem('un');
        }
        if (localStorage.getItem('role') === null) {
            this.role = "";
        }
        else {
            this.role = localStorage.getItem('role');
        }
    }
    getSelect(sql, params) {
        this.getLocalStorage();
        const data = {
            "q": 'getselect',
            "sql": sql,
            "parameters": params,
            "uid": this.uid
        };
        this.t = this.http.post(this.base + "sqlcomponents.php", data);
        return this.t;
    }
    getColumns(sql, params) {
        this.getLocalStorage();
        const data = {
            "q": 'getcolumns',
            "sql": sql,
            "parameters": params,
            "uid": this.uid
        };
        this.t = this.http.post(this.base + "sqlcomponents.php", data);
        return this.t;
    }
    pingParameters(path) {
        let output = { page: '', id: '', id2: '', id3: '' };
        let j = path.split('/');
        if (j[1] !== undefined) {
            output.page = j[1];
        }
        if (j[2] !== undefined) {
            output.id = j[2];
        }
        if (j[3] !== undefined) {
            output.id2 = j[3];
        }
        if (j[4] !== undefined) {
            output.id3 = j[4];
        }
        return of(output);
    }
    getSQL(sql, id) {
        this.counter++;
        this.getLocalStorage();
        const data = {
            "counter": this.counter,
            "q": "getsql",
            "parameters": id,
            "sql": sql,
            "uid": this.uid,
        };
        if (this.counter != 2) {
            this.t = this.http.post(this.base + "sqlcomponents.php", data);
            return this.t;
        }
    }
    getMenu(sql, id) {
        this.getLocalStorage();
        const data = {
            "q": "getmenu",
            "parameters": id,
            "sql": sql,
            "uid": this.uid
        };
        this.t = this.http.post(this.base + "sqlcomponents.php", data);
        return this.t;
    }
    postSQL(formData) {
        var CryptoJSAesJson = {
            stringify: function (cipherParams) {
                var j = { ct: cipherParams.ciphertext.toString(CryptoJS.enc.Base64) };
                if (cipherParams.iv)
                    j.iv = cipherParams.iv.toString();
                if (cipherParams.salt)
                    j.s = cipherParams.salt.toString();
                return JSON.stringify(j);
            },
            parse: function (jsonStr) {
                var j = JSON.parse(jsonStr);
                var cipherParams = CryptoJS.lib.CipherParams.create({
                    ciphertext: CryptoJS.enc.Base64.parse(j.ct),
                });
                if (j.iv)
                    cipherParams.iv = CryptoJS.enc.Hex.parse(j.iv);
                if (j.s)
                    cipherParams.salt = CryptoJS.enc.Hex.parse(j.s);
                return cipherParams;
            },
        };
        this.getLocalStorage();
        console.log(formData.triggers);
        if (formData.triggers !== undefined) {
            let triggers = formData.triggers;
            let k = CryptoJS.AES.encrypt(JSON.stringify(triggers), this.TheSecret, { format: CryptoJSAesJson }).toString();
            formData.triggers = k;
        }
        const data = {
            "q": "postform",
            "data": formData,
            "uid": this.uid
        };
        this.t = this.http.post(this.base + "sqlcomponents.php", data);
        return this.t;
    }
    postDelete(formData) {
        var CryptoJSAesJson = {
            stringify: function (cipherParams) {
                var j = { ct: cipherParams.ciphertext.toString(CryptoJS.enc.Base64) };
                if (cipherParams.iv)
                    j.iv = cipherParams.iv.toString();
                if (cipherParams.salt)
                    j.s = cipherParams.salt.toString();
                return JSON.stringify(j);
            },
            parse: function (jsonStr) {
                var j = JSON.parse(jsonStr);
                var cipherParams = CryptoJS.lib.CipherParams.create({
                    ciphertext: CryptoJS.enc.Base64.parse(j.ct),
                });
                if (j.iv)
                    cipherParams.iv = CryptoJS.enc.Hex.parse(j.iv);
                if (j.s)
                    cipherParams.salt = CryptoJS.enc.Hex.parse(j.s);
                return cipherParams;
            },
        };
        this.getLocalStorage();
        console.log(formData.triggers);
        if (formData.triggers !== undefined) {
            let triggers = formData.triggers;
            let k = CryptoJS.AES.encrypt(JSON.stringify(triggers), this.TheSecret, { format: CryptoJSAesJson }).toString();
            formData.triggers = k;
        }
        const data = {
            "q": "postdelete",
            "data": formData,
            "uid": this.uid
        };
        this.t = this.http.post(this.base + "sqlcomponents.php", data);
        return this.t;
    }
    getData(path, id, id2, id3, id_col, id_col2, id_col3) {
        this.getLocalStorage();
        const data = {
            "q": path,
            "id": id,
            "id2": id2,
            "id3": id3,
            "id_col": id_col,
            "id2_col": id_col2,
            "id3_col": id_col3,
            "uid": this.uid
        };
        this.t = this.http.post(this.url, data);
        return this.t;
    }
    postForm(formData) {
        var CryptoJSAesJson = {
            stringify: function (cipherParams) {
                var j = { ct: cipherParams.ciphertext.toString(CryptoJS.enc.Base64) };
                if (cipherParams.iv)
                    j.iv = cipherParams.iv.toString();
                if (cipherParams.salt)
                    j.s = cipherParams.salt.toString();
                return JSON.stringify(j);
            },
            parse: function (jsonStr) {
                var j = JSON.parse(jsonStr);
                var cipherParams = CryptoJS.lib.CipherParams.create({
                    ciphertext: CryptoJS.enc.Base64.parse(j.ct),
                });
                if (j.iv)
                    cipherParams.iv = CryptoJS.enc.Hex.parse(j.iv);
                if (j.s)
                    cipherParams.salt = CryptoJS.enc.Hex.parse(j.s);
                return cipherParams;
            },
        };
        this.getLocalStorage();
        let k = CryptoJS.AES.encrypt(JSON.stringify(formData), this.TheSecret, { format: CryptoJSAesJson }).toString();
        const data = {
            "q": "postform",
            "data": k,
            "uid": this.uid
        };
        this.t = this.http.post(this.url, data);
        return this.t;
    }
    getUser() {
        this.getLocalStorage();
        const data = {
            "q": "vertical-menu",
            "uid": this.uid,
            "role": this.role
        };
        this.t = this.http.post("https://myna-api.com/api/u.php", data);
        return this.t;
    }
    getForm(table_name, parameters) {
        this.getLocalStorage();
        const data = {
            "q": "getform",
            "table": table_name,
            "parameters": parameters
        };
        this.t = this.http.post(this.base + "sqlcomponents.php", data);
        return this.t;
    }
    pushNotification(data) {
        this.dataSubject.next(data);
    }
    pushPage(data) {
        this.pageSubject.next(data);
    }
    getCalendar(sql, params) {
        this.getLocalStorage();
        const data = {
            "q": 'calendar',
            "sql": sql,
            "parameters": params,
            "uid": this.uid
        };
        this.t = this.http.post(this.base + "sqlcomponents.php", data);
        return this.t;
    }
}
SQLDataService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.3", ngImport: i0, type: SQLDataService, deps: [{ token: i1.HttpClient }, { token: 'WEBSERVER' }], target: i0.ɵɵFactoryTarget.Injectable });
SQLDataService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.3", ngImport: i0, type: SQLDataService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.3", ngImport: i0, type: SQLDataService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i1.HttpClient }, { type: undefined, decorators: [{
                    type: Inject,
                    args: ['WEBSERVER']
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvc3FsLWNvbXBvbmVudHMvc3JjL2xpYi9kYXRhLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFbkQsT0FBTyxFQUFFLGVBQWUsRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDM0MsT0FBTyxLQUFLLFFBQVEsTUFBTSxXQUFXLENBQUM7OztBQUt0QyxNQUFNLE9BQU8sY0FBYztJQXlCekIsWUFBb0IsSUFBZ0IsRUFBZ0MsU0FBaUI7UUFBakUsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUFnQyxjQUFTLEdBQVQsU0FBUyxDQUFRO1FBdkI5RSxnQkFBVyxHQUFHLElBQUksZUFBZSxDQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQzNDLGdCQUFXLEdBQUcsSUFBSSxlQUFlLENBQU0sRUFBRSxDQUFDLENBQUM7UUFDM0MsaUJBQVksR0FBRyxJQUFJLGVBQWUsQ0FBTSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQzNILGtCQUFhLEdBQUcsSUFBSSxlQUFlLENBQU0sRUFBRSxDQUFDLENBQUM7UUFDN0MscUJBQWdCLEdBQUcsSUFBSSxlQUFlLENBQU0sRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFHekgsY0FB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Y3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBDbGllbnRNb2R1bGUsIEh0dHBIZWFkZXJzLCBIdHRwUGFyYW1zIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0ICogYXMgQ3J5cHRvSlMgZnJvbSAnY3J5cHRvLWpzJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgU1FMRGF0YVNlcnZpY2Uge1xuXG4gIHB1YmxpYyBkYXRhU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55Pih7fSk7XG4gIHB1YmxpYyBwYWdlU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55Pih7fSk7XG4gIHB1YmxpYyBwYXJhbVN1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGFueT4oeyBwYWdlOiBcIkFBQVwiLCBpZDogXCJcIiwgaWQyOiBcIlwiLCBpZDM6IFwiXCIsIGlkX2NvbDogXCJpZFwiLCBpZDJfY29sOiBcIlwiLCBpZDNfY29sOiBcIlwiIH0pO1xuICBwdWJsaWMgcm91dGVyU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55Pih7fSk7XG4gIHB1YmxpYyBjb250YWluZXJTdWJqZWN0ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnk+KHsgaWQ6IFwiXCIsIGlkMjogXCJcIiwgaWQzOiBcIlwiLCBpZF9jb2w6IFwiaWRcIiwgaWQyX2NvbDogXCJcIiwgaWQzX2NvbDogXCJcIiB9KTtcblxuICBlbkRhdGE6IGFueTtcbiAgZGF0YVZhbHVlOiBhbnkgPSB7IGlkOiBcImhlbGxvXCIsIGlkMjogXCJ3b3JsZFwiIH1cbiAgVGhlU2VjcmV0PVwiaGlkZS10cmlnZ2Vyc1wiO1xuICBzYWx0SGV4OiBhbnk7XG4gIGN0SGV4OiBhbnk7XG4gIGl2SGV4OiBhbnk7XG5cbiAgdDogYW55O1xuICB1aWQ6IGFueTtcbiAgdXJsOiBhbnk7XG4gIGJhc2U6IGFueTtcbiAgc3VybDogYW55O1xuICB1bjogYW55O1xuICByb2xlOiBhbnk7XG4gIGNvbmZpZzogYW55O1xuICBjb3VudGVyOiBudW1iZXIgPSAwO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cENsaWVudCwgIEBJbmplY3QoJ1dFQlNFUlZFUicpIHByaXZhdGUgd2Vic2VydmVyOiBzdHJpbmcpIHsgXG4gICAgICAgIGlmICh3ZWJzZXJ2ZXI9PT0nJ3x8d2Vic2VydmVyPT09dW5kZWZpbmVkKSB7XG4gICAgICAgICAgYWxlcnQoXCJNaXNzaW5nIFByb3ZpZGVyIGluIG1vZHVsZS50cy4gSXQgc2hvdWxkIGluY2x1ZGU6IHsgcHJvdmlkZTogV0VCU0VSVkVSLCB1c2VWYWx1ZTogJ2h0dHBzOi8vZXhhbXBsZS5jb20vYXBpLycgfVwiKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuYmFzZT13ZWJzZXJ2ZXI7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cmw9dGhpcy5iYXNlKydzcWxjb21wb25lbnRzLnBocCc7XG5cbiAgfVxuXG4gIGdldExvY2FsU3RvcmFnZSgpIHtcbiAgICAvL1xuICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndWlkJyk9PT1udWxsKSB7XG4gICAgICB0aGlzLnVpZD1cIjBcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy51aWQ9bG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VpZCcpXG4gICAgfVxuXG4gICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1bicpPT09bnVsbCkge1xuICAgICAgdGhpcy51bj1cIlwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVuPWxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1bicpXG4gICAgfVxuXG4gICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdyb2xlJyk9PT1udWxsKSB7XG4gICAgICB0aGlzLnJvbGU9XCJcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yb2xlPWxvY2FsU3RvcmFnZS5nZXRJdGVtKCdyb2xlJylcbiAgICB9XG4gIH1cblxuICBnZXRTZWxlY3Qoc3FsOiBhbnksIHBhcmFtczogYW55KSB7XG4gICAgdGhpcy5nZXRMb2NhbFN0b3JhZ2UoKTtcbiAgICBjb25zdCBkYXRhID0ge1xuICAgICAgXCJxXCIgOiAnZ2V0c2VsZWN0JyxcbiAgICAgIFwic3FsXCI6IHNxbCwgICBcbiAgICAgIFwicGFyYW1ldGVyc1wiOiBwYXJhbXMsICAgXG4gICAgICBcInVpZFwiOiB0aGlzLnVpZFxuICAgIH1cblxuICB0aGlzLnQ9IHRoaXMuaHR0cC5wb3N0KHRoaXMuYmFzZStcInNxbGNvbXBvbmVudHMucGhwXCIsIGRhdGEpO1xuICByZXR1cm4gdGhpcy50O1xuXG4gIH1cblxuICBnZXRDb2x1bW5zKHNxbDogYW55LCBwYXJhbXM6IGFueSkge1xuICAgIHRoaXMuZ2V0TG9jYWxTdG9yYWdlKCk7XG4gICAgY29uc3QgZGF0YSA9IHtcbiAgICAgIFwicVwiIDogJ2dldGNvbHVtbnMnLFxuICAgICAgXCJzcWxcIjogc3FsLCAgIFxuICAgICAgXCJwYXJhbWV0ZXJzXCI6IHBhcmFtcywgICBcbiAgICAgIFwidWlkXCI6IHRoaXMudWlkXG4gICAgfVxuXG4gIHRoaXMudD0gdGhpcy5odHRwLnBvc3QodGhpcy5iYXNlK1wic3FsY29tcG9uZW50cy5waHBcIiwgZGF0YSk7XG4gIHJldHVybiB0aGlzLnQ7XG5cbiAgfVxuXG4gIHBpbmdQYXJhbWV0ZXJzKHBhdGg6IGFueSkge1xuXG4gICAgICBsZXQgb3V0cHV0OiBhbnkgPSB7IHBhZ2U6ICcnLCBpZDogJycsIGlkMjogJycsIGlkMzogJycgfTtcbiAgXG4gICAgICBsZXQgajogYW55ID0gcGF0aC5zcGxpdCgnLycpO1xuICBcbiAgICAgIGlmIChqWzFdIT09dW5kZWZpbmVkKSB7IG91dHB1dC5wYWdlPWpbMV07IH1cbiAgICAgIGlmIChqWzJdIT09dW5kZWZpbmVkKSB7IG91dHB1dC5pZD1qWzJdOyAgIH1cbiAgICAgIGlmIChqWzNdIT09dW5kZWZpbmVkKSB7IG91dHB1dC5pZDI9alszXTsgIH1cbiAgICAgIGlmIChqWzRdIT09dW5kZWZpbmVkKSB7IG91dHB1dC5pZDM9als0XTsgIH1cbiAgXG4gICAgICByZXR1cm4gb2Yob3V0cHV0KTtcbiAgXG4gIH1cblxuICBnZXRTUUwoc3FsOiBhbnksIGlkOiBhbnkpIHtcbiAgICB0aGlzLmNvdW50ZXIrKztcbiAgICB0aGlzLmdldExvY2FsU3RvcmFnZSgpO1xuICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICBcImNvdW50ZXJcIjogdGhpcy5jb3VudGVyLFxuICAgICAgXCJxXCI6IFwiZ2V0c3FsXCIsXG4gICAgICBcInBhcmFtZXRlcnNcIiA6IGlkLFxuICAgICAgXCJzcWxcIjogc3FsLCAgICAgXG4gICAgICBcInVpZFwiOiB0aGlzLnVpZCxcbiAgICB9XG4gICAgaWYgKHRoaXMuY291bnRlciE9Mikge1xuICAgICAgdGhpcy50PSB0aGlzLmh0dHAucG9zdCh0aGlzLmJhc2UrXCJzcWxjb21wb25lbnRzLnBocFwiLCBkYXRhKTtcbiAgICAgIHJldHVybiB0aGlzLnQ7XG4gICAgfVxuICB9XG5cbiAgZ2V0TWVudShzcWw6IGFueSwgaWQ6IGFueSkge1xuICAgIHRoaXMuZ2V0TG9jYWxTdG9yYWdlKCk7XG4gICAgY29uc3QgZGF0YSA9IHtcbiAgICAgIFwicVwiOiBcImdldG1lbnVcIixcbiAgICAgIFwicGFyYW1ldGVyc1wiIDogaWQsXG4gICAgICBcInNxbFwiOiBzcWwsICBcbiAgICAgIFwidWlkXCI6IHRoaXMudWlkXG4gICAgfVxuXG4gIHRoaXMudD0gdGhpcy5odHRwLnBvc3QodGhpcy5iYXNlK1wic3FsY29tcG9uZW50cy5waHBcIiwgZGF0YSk7XG4gIHJldHVybiB0aGlzLnQ7XG5cbiAgfVxuXG4gIHBvc3RTUUwoZm9ybURhdGE6IGFueSkge1xuXG4gICAgdmFyIENyeXB0b0pTQWVzSnNvbiA9IHtcbiAgICAgIHN0cmluZ2lmeTogZnVuY3Rpb24gKGNpcGhlclBhcmFtczogYW55KSB7XG4gICAgICAgIHZhciBqOiBhbnkgPSB7IGN0OiBjaXBoZXJQYXJhbXMuY2lwaGVydGV4dC50b1N0cmluZyhDcnlwdG9KUy5lbmMuQmFzZTY0KSB9O1xuICAgICAgICBpZiAoY2lwaGVyUGFyYW1zLml2KSBqLml2ID0gY2lwaGVyUGFyYW1zLml2LnRvU3RyaW5nKCk7XG4gICAgICAgIGlmIChjaXBoZXJQYXJhbXMuc2FsdCkgai5zID0gY2lwaGVyUGFyYW1zLnNhbHQudG9TdHJpbmcoKTtcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGopO1xuICAgICAgfSxcbiAgICAgIHBhcnNlOiBmdW5jdGlvbiAoanNvblN0cjogYW55KSB7XG4gICAgICAgIHZhciBqID0gSlNPTi5wYXJzZShqc29uU3RyKTtcbiAgICAgICAgdmFyIGNpcGhlclBhcmFtcyA9IENyeXB0b0pTLmxpYi5DaXBoZXJQYXJhbXMuY3JlYXRlKHtcbiAgICAgICAgICBjaXBoZXJ0ZXh0OiBDcnlwdG9KUy5lbmMuQmFzZTY0LnBhcnNlKGouY3QpLFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGouaXYpIGNpcGhlclBhcmFtcy5pdiA9IENyeXB0b0pTLmVuYy5IZXgucGFyc2Uoai5pdik7XG4gICAgICAgIGlmIChqLnMpIGNpcGhlclBhcmFtcy5zYWx0ID0gQ3J5cHRvSlMuZW5jLkhleC5wYXJzZShqLnMpO1xuICAgICAgICByZXR1cm4gY2lwaGVyUGFyYW1zO1xuICAgICAgfSxcbiAgICB9O1xuXG4gICAgdGhpcy5nZXRMb2NhbFN0b3JhZ2UoKTtcblxuICAgIGNvbnNvbGUubG9nKGZvcm1EYXRhLnRyaWdnZXJzKVxuICAgIGlmIChmb3JtRGF0YS50cmlnZ2VycyE9PXVuZGVmaW5lZCkge1xuICAgICAgbGV0IHRyaWdnZXJzPWZvcm1EYXRhLnRyaWdnZXJzO1xuICAgICAgbGV0IGsgPSBDcnlwdG9KUy5BRVMuZW5jcnlwdChKU09OLnN0cmluZ2lmeSh0cmlnZ2VycyksIHRoaXMuVGhlU2VjcmV0LCB7Zm9ybWF0OiBDcnlwdG9KU0Flc0pzb259KS50b1N0cmluZygpO1xuICAgICAgZm9ybURhdGEudHJpZ2dlcnM9aztcbiAgICB9XG5cbiAgICBjb25zdCBkYXRhID0ge1xuICAgICAgXCJxXCIgOiBcInBvc3Rmb3JtXCIsXG4gICAgICBcImRhdGFcIjogZm9ybURhdGEsXG4gICAgICBcInVpZFwiOiB0aGlzLnVpZFxuICAgIH1cblxuICB0aGlzLnQ9IHRoaXMuaHR0cC5wb3N0KHRoaXMuYmFzZStcInNxbGNvbXBvbmVudHMucGhwXCIsIGRhdGEpO1xuICByZXR1cm4gdGhpcy50O1xuXG4gIH1cblxuICBwb3N0RGVsZXRlKGZvcm1EYXRhOiBhbnkpIHtcblxuICAgIHZhciBDcnlwdG9KU0Flc0pzb24gPSB7XG4gICAgICBzdHJpbmdpZnk6IGZ1bmN0aW9uIChjaXBoZXJQYXJhbXM6IGFueSkge1xuICAgICAgICB2YXIgajogYW55ID0geyBjdDogY2lwaGVyUGFyYW1zLmNpcGhlcnRleHQudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkJhc2U2NCkgfTtcbiAgICAgICAgaWYgKGNpcGhlclBhcmFtcy5pdikgai5pdiA9IGNpcGhlclBhcmFtcy5pdi50b1N0cmluZygpO1xuICAgICAgICBpZiAoY2lwaGVyUGFyYW1zLnNhbHQpIGoucyA9IGNpcGhlclBhcmFtcy5zYWx0LnRvU3RyaW5nKCk7XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShqKTtcbiAgICAgIH0sXG4gICAgICBwYXJzZTogZnVuY3Rpb24gKGpzb25TdHI6IGFueSkge1xuICAgICAgICB2YXIgaiA9IEpTT04ucGFyc2UoanNvblN0cik7XG4gICAgICAgIHZhciBjaXBoZXJQYXJhbXMgPSBDcnlwdG9KUy5saWIuQ2lwaGVyUGFyYW1zLmNyZWF0ZSh7XG4gICAgICAgICAgY2lwaGVydGV4dDogQ3J5cHRvSlMuZW5jLkJhc2U2NC5wYXJzZShqLmN0KSxcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChqLml2KSBjaXBoZXJQYXJhbXMuaXYgPSBDcnlwdG9KUy5lbmMuSGV4LnBhcnNlKGouaXYpO1xuICAgICAgICBpZiAoai5zKSBjaXBoZXJQYXJhbXMuc2FsdCA9IENyeXB0b0pTLmVuYy5IZXgucGFyc2Uoai5zKTtcbiAgICAgICAgcmV0dXJuIGNpcGhlclBhcmFtcztcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIHRoaXMuZ2V0TG9jYWxTdG9yYWdlKCk7XG5cbiAgICBjb25zb2xlLmxvZyhmb3JtRGF0YS50cmlnZ2VycylcbiAgICBpZiAoZm9ybURhdGEudHJpZ2dlcnMhPT11bmRlZmluZWQpIHtcbiAgICAgIGxldCB0cmlnZ2Vycz1mb3JtRGF0YS50cmlnZ2VycztcbiAgICAgIGxldCBrID0gQ3J5cHRvSlMuQUVTLmVuY3J5cHQoSlNPTi5zdHJpbmdpZnkodHJpZ2dlcnMpLCB0aGlzLlRoZVNlY3JldCwge2Zvcm1hdDogQ3J5cHRvSlNBZXNKc29ufSkudG9TdHJpbmcoKTtcbiAgICAgIGZvcm1EYXRhLnRyaWdnZXJzPWs7XG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IHtcbiAgICAgIFwicVwiIDogXCJwb3N0ZGVsZXRlXCIsXG4gICAgICBcImRhdGFcIjogZm9ybURhdGEsXG4gICAgICBcInVpZFwiOiB0aGlzLnVpZFxuICAgIH1cblxuICB0aGlzLnQ9IHRoaXMuaHR0cC5wb3N0KHRoaXMuYmFzZStcInNxbGNvbXBvbmVudHMucGhwXCIsIGRhdGEpO1xuICByZXR1cm4gdGhpcy50O1xuXG4gIH1cblxuICBnZXREYXRhKHBhdGg6IGFueSwgaWQ6IGFueSwgaWQyOiBhbnksIGlkMzogYW55LCBpZF9jb2w6IGFueSwgaWRfY29sMjogYW55LCBpZF9jb2wzOiBhbnkpIHtcbiAgICB0aGlzLmdldExvY2FsU3RvcmFnZSgpO1xuICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICBcInFcIiA6IHBhdGgsXG4gICAgICBcImlkXCI6IGlkLFxuICAgICAgXCJpZDJcIjogaWQyLFxuICAgICAgXCJpZDNcIjogaWQzLCBcbiAgICAgIFwiaWRfY29sXCI6IGlkX2NvbCxcbiAgICAgIFwiaWQyX2NvbFwiOiBpZF9jb2wyLFxuICAgICAgXCJpZDNfY29sXCI6IGlkX2NvbDMsICAgICAgXG4gICAgICBcInVpZFwiOiB0aGlzLnVpZFxuICAgIH1cblxuICB0aGlzLnQ9IHRoaXMuaHR0cC5wb3N0KHRoaXMudXJsLCBkYXRhKTtcbiAgcmV0dXJuIHRoaXMudDtcblxuICB9XG5cbiAgcG9zdEZvcm0oZm9ybURhdGE6IGFueVtdKSB7XG5cbiAgICB2YXIgQ3J5cHRvSlNBZXNKc29uID0ge1xuICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbiAoY2lwaGVyUGFyYW1zOiBhbnkpIHtcbiAgICAgICAgdmFyIGo6IGFueSA9IHsgY3Q6IGNpcGhlclBhcmFtcy5jaXBoZXJ0ZXh0LnRvU3RyaW5nKENyeXB0b0pTLmVuYy5CYXNlNjQpIH07XG4gICAgICAgIGlmIChjaXBoZXJQYXJhbXMuaXYpIGouaXYgPSBjaXBoZXJQYXJhbXMuaXYudG9TdHJpbmcoKTtcbiAgICAgICAgaWYgKGNpcGhlclBhcmFtcy5zYWx0KSBqLnMgPSBjaXBoZXJQYXJhbXMuc2FsdC50b1N0cmluZygpO1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoaik7XG4gICAgICB9LFxuICAgICAgcGFyc2U6IGZ1bmN0aW9uIChqc29uU3RyOiBhbnkpIHtcbiAgICAgICAgdmFyIGogPSBKU09OLnBhcnNlKGpzb25TdHIpO1xuICAgICAgICB2YXIgY2lwaGVyUGFyYW1zID0gQ3J5cHRvSlMubGliLkNpcGhlclBhcmFtcy5jcmVhdGUoe1xuICAgICAgICAgIGNpcGhlcnRleHQ6IENyeXB0b0pTLmVuYy5CYXNlNjQucGFyc2Uoai5jdCksXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoai5pdikgY2lwaGVyUGFyYW1zLml2ID0gQ3J5cHRvSlMuZW5jLkhleC5wYXJzZShqLml2KTtcbiAgICAgICAgaWYgKGoucykgY2lwaGVyUGFyYW1zLnNhbHQgPSBDcnlwdG9KUy5lbmMuSGV4LnBhcnNlKGoucyk7XG4gICAgICAgIHJldHVybiBjaXBoZXJQYXJhbXM7XG4gICAgICB9LFxuICAgIH07XG5cbiAgICB0aGlzLmdldExvY2FsU3RvcmFnZSgpO1xuXG4gICAgbGV0IGsgPSBDcnlwdG9KUy5BRVMuZW5jcnlwdChKU09OLnN0cmluZ2lmeShmb3JtRGF0YSksIHRoaXMuVGhlU2VjcmV0LCB7Zm9ybWF0OiBDcnlwdG9KU0Flc0pzb259KS50b1N0cmluZygpO1xuXG4gICAgY29uc3QgZGF0YSA9IHtcbiAgICAgIFwicVwiIDogXCJwb3N0Zm9ybVwiLFxuICAgICAgXCJkYXRhXCI6IGssXG4gICAgICBcInVpZFwiOiB0aGlzLnVpZFxuICAgIH1cblxuICB0aGlzLnQ9IHRoaXMuaHR0cC5wb3N0KHRoaXMudXJsLCBkYXRhKTtcbiAgcmV0dXJuIHRoaXMudDtcblxuICB9XG5cbiAgZ2V0VXNlcigpIHtcbiAgICB0aGlzLmdldExvY2FsU3RvcmFnZSgpXG4gICAgY29uc3QgZGF0YSA9IHtcbiAgICAgIFwicVwiIDogXCJ2ZXJ0aWNhbC1tZW51XCIsXG4gICAgICBcInVpZFwiOiB0aGlzLnVpZCxcbiAgICAgIFwicm9sZVwiOiB0aGlzLnJvbGVcbiAgICB9XG5cbiAgICB0aGlzLnQ9IHRoaXMuaHR0cC5wb3N0KFwiaHR0cHM6Ly9teW5hLWFwaS5jb20vYXBpL3UucGhwXCIsIGRhdGEpO1xuICAgIHJldHVybiB0aGlzLnQ7XG5cbiAgfVxuICBcbiAgZ2V0Rm9ybSh0YWJsZV9uYW1lOiBhbnksIHBhcmFtZXRlcnM6IGFueSkge1xuICAgIHRoaXMuZ2V0TG9jYWxTdG9yYWdlKClcbiAgICBjb25zdCBkYXRhID0ge1xuICAgICAgXCJxXCIgOiBcImdldGZvcm1cIixcbiAgICAgIFwidGFibGVcIjogdGFibGVfbmFtZSxcbiAgICAgIFwicGFyYW1ldGVyc1wiOiBwYXJhbWV0ZXJzXG4gICAgfVxuXG4gICAgdGhpcy50PSB0aGlzLmh0dHAucG9zdCh0aGlzLmJhc2UrXCJzcWxjb21wb25lbnRzLnBocFwiLCBkYXRhKTtcbiAgICByZXR1cm4gdGhpcy50O1xuXG4gIH1cblxucHVzaE5vdGlmaWNhdGlvbihkYXRhOiBhbnkpIHtcbiAgdGhpcy5kYXRhU3ViamVjdC5uZXh0KGRhdGEpO1xufVxuXG5wdXNoUGFnZShkYXRhOiBhbnkpIHtcbiAgdGhpcy5wYWdlU3ViamVjdC5uZXh0KGRhdGEpO1xufVxuXG5nZXRDYWxlbmRhcihzcWw6IGFueSwgcGFyYW1zOiBhbnkpIHtcbiAgICAgIHRoaXMuZ2V0TG9jYWxTdG9yYWdlKCk7XG4gICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICBcInFcIiA6ICdjYWxlbmRhcicsXG4gICAgICAgIFwic3FsXCI6IHNxbCwgICBcbiAgICAgICAgXCJwYXJhbWV0ZXJzXCI6IHBhcmFtcywgICBcbiAgICAgICAgXCJ1aWRcIjogdGhpcy51aWRcbiAgICAgIH1cblxuICAgIHRoaXMudD0gdGhpcy5odHRwLnBvc3QodGhpcy5iYXNlK1wic3FsY29tcG9uZW50cy5waHBcIiwgZGF0YSk7XG4gICAgcmV0dXJuIHRoaXMudDtcblxufVxuXG59XG4iXX0=