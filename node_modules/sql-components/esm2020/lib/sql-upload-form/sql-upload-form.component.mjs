import { Component, Input, Output, EventEmitter } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule, ReactiveFormsModule, FormControl } from '@angular/forms';
import { HttpClientModule } from '@angular/common/http';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "../data.service";
import * as i3 from "@angular/forms";
export class SqlUploadFormComponent {
    constructor(_http, _dataService) {
        this._http = _http;
        this._dataService = _dataService;
        this.last_id = '';
        this.path = "https://myna-docs.com/upload.php";
        this.id = '0'; // Primary key for an existing record = 0=Insert
        this.table = "dual"; // Name of the base table.
        this.embedded = "N"; // Is the form embedded in a list.
        this.card = "Y"; // Show the form in a card Y/N
        this.closable = "N"; // Is the form closable Y/N
        this.open = "Y"; // Does a closable form start open.
        this.class = ""; // Class for the form container.
        this.style = ""; // Style for the form container.
        this.title = ""; // Title of the form.
        this.bs_row = 'Y'; // Y means add a bootstrap row.
        this.bs_col = 'col-sm-12 col-lg-6 col-xl-4'; // What bootstrap columns.
        this.handler = 'default'; // what handler is used to process the form.
        this.change = new EventEmitter();
        this.saved = new EventEmitter();
        this.counter = 0;
        this.showErrorAlert = 'N';
        this.errorMessage = 'Post Failed';
        this.showSuccessAlert = 'N';
        this.file = new FormControl('');
        this.file_data = '';
        this.myObs = this._dataService.dataSubject.subscribe(d => {
            this.data = d;
            this.counter++;
            if (this.data.id != this.last_id) {
                this.last_id = this.data.id;
                this.id = this.data.id;
                this.ngAfterViewInit();
            }
            if (this.data.submit === 'Y') {
                this.postSQL();
            }
        });
    }
    ngOnInit() {
    }
    showUpload() {
        this.change.emit('DONE');
    }
    ngAfterViewInit() {
        if (this.embedded == 'Y') {
            this.id == this.data.id;
        }
        this._dataService.getForm(this.table, this.id).subscribe((data) => {
            this.data = data;
            this._dataService.pushNotification(this.data);
        });
    }
    postSQL() {
        this._dataService.postSQL(this.data).subscribe((data) => {
            if (data.error_code == "0") {
                this.showSuccessAlert = 'Y';
                this.showErrorAlert = 'N';
                this.errorMessage = 'Record Saved';
            }
            else {
                this.showSuccessAlert = 'N';
                this.showErrorAlert = 'Y';
                this.errorMessage = data.error_message;
                this.errorMessage = 'Record Saved';
            }
            this._dataService.pushNotification(data);
            setTimeout(() => {
                this.showErrorAlert = 'N';
                this.showSuccessAlert = 'N';
            }, 5000);
        });
    }
    ngDoCheck() {
    }
    ngOnChanges(changes) {
    }
    fileChange(index, event) {
        const fileList = event.target.files;
        if (fileList.length > 0) {
            let k;
            let v;
            const file = fileList[0];
            if ((file.size / 1048576) <= 8) {
                let formData = new FormData();
                formData.append('file', file, file.name);
                for ([k, v] of Object.entries(this.data)) {
                    formData.append(k, v);
                }
                this.file_data = formData;
            }
            else {
                alert('File size exceeds 8 MB. Please choose less than 8 MB');
            }
        }
    }
    uploadFile() {
        this._http.post(this.path, this.file_data)
            .subscribe(res => {
            location.reload();
        }, (err) => {
            //send error response
            alert('error occured');
        });
    }
    ngOnDestroy() {
        this.myObs.unsubscribe();
    }
}
SqlUploadFormComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.3", ngImport: i0, type: SqlUploadFormComponent, deps: [{ token: i1.HttpClient }, { token: i2.SQLDataService }], target: i0.ɵɵFactoryTarget.Component });
SqlUploadFormComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.3", type: SqlUploadFormComponent, isStandalone: true, selector: "sql-upload-form", inputs: { data: "data", path: "path", id: "id", table: "table", embedded: "embedded", card: "card", closable: "closable", open: "open", class: "class", style: "style", title: "title", bs_row: "bs_row", bs_col: "bs_col", handler: "handler" }, outputs: { change: "change", saved: "saved" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"card\">\n    <div class=\"card-header\" style=\"margin-top: 0px;\">\n       <h2>{{ title }}</h2>\n    </div>\n    <div class=\"card-body\">\n        <div class=\"row\">\n            <ng-content></ng-content>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"col-6 p-3\">\n            <input style=\"margin-left: 20px;\" class=\"btn-dark btn\" [formControl]=\"file\" (change)=\"fileChange(index,$event)\" type=\"file\" placeholder=\"File\">\n        </div>\n        <div class=\"col-6 p-3\">\n            <button (click)=\"showUpload()\" class=\"btn btn-light\">\n                Cancel\n            </button>\n            <button style=\"margin-left:20px;\" (click)=\"uploadFile()\" class=\"btn btn-primary\">\n                Upload\n            </button>\n        </div>\n    </div>\n</div>", styles: [""], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i3.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "ngmodule", type: HttpClientModule }, { kind: "ngmodule", type: ReactiveFormsModule }, { kind: "directive", type: i3.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.3", ngImport: i0, type: SqlUploadFormComponent, decorators: [{
            type: Component,
            args: [{ selector: 'sql-upload-form', standalone: true, imports: [CommonModule, FormsModule, HttpClientModule, ReactiveFormsModule], template: "<div class=\"card\">\n    <div class=\"card-header\" style=\"margin-top: 0px;\">\n       <h2>{{ title }}</h2>\n    </div>\n    <div class=\"card-body\">\n        <div class=\"row\">\n            <ng-content></ng-content>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"col-6 p-3\">\n            <input style=\"margin-left: 20px;\" class=\"btn-dark btn\" [formControl]=\"file\" (change)=\"fileChange(index,$event)\" type=\"file\" placeholder=\"File\">\n        </div>\n        <div class=\"col-6 p-3\">\n            <button (click)=\"showUpload()\" class=\"btn btn-light\">\n                Cancel\n            </button>\n            <button style=\"margin-left:20px;\" (click)=\"uploadFile()\" class=\"btn btn-primary\">\n                Upload\n            </button>\n        </div>\n    </div>\n</div>" }]
        }], ctorParameters: function () { return [{ type: i1.HttpClient }, { type: i2.SQLDataService }]; }, propDecorators: { data: [{
                type: Input
            }], path: [{
                type: Input
            }], id: [{
                type: Input
            }], table: [{
                type: Input
            }], embedded: [{
                type: Input
            }], card: [{
                type: Input
            }], closable: [{
                type: Input
            }], open: [{
                type: Input
            }], class: [{
                type: Input
            }], style: [{
                type: Input
            }], title: [{
                type: Input
            }], bs_row: [{
                type: Input
            }], bs_col: [{
                type: Input
            }], handler: [{
                type: Input
            }], change: [{
                type: Output
            }], saved: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3FsLXVwbG9hZC1mb3JtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3NxbC1jb21wb25lbnRzL3NyYy9saWIvc3FsLXVwbG9hZC1mb3JtL3NxbC11cGxvYWQtZm9ybS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zcWwtY29tcG9uZW50cy9zcmMvbGliL3NxbC11cGxvYWQtZm9ybS9zcWwtdXBsb2FkLWZvcm0uY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBc0YsTUFBTSxlQUFlLENBQUM7QUFDbkssT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBSS9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsbUJBQW1CLEVBQWEsV0FBVyxFQUEyQixNQUFNLGdCQUFnQixDQUFDO0FBQ25ILE9BQU8sRUFBcUMsZ0JBQWdCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQzs7Ozs7QUFVM0YsTUFBTSxPQUFPLHNCQUFzQjtJQUtqQyxZQUFvQixLQUFpQixFQUFVLFlBQTRCO1FBQXZELFVBQUssR0FBTCxLQUFLLENBQVk7UUFBVSxpQkFBWSxHQUFaLFlBQVksQ0FBZ0I7UUFIM0UsWUFBTyxHQUFRLEVBQUUsQ0FBQztRQXFCVCxTQUFJLEdBQVEsa0NBQWtDLENBQUM7UUFDL0MsT0FBRSxHQUFRLEdBQUcsQ0FBQyxDQUFpQyxnREFBZ0Q7UUFDL0YsVUFBSyxHQUFRLE1BQU0sQ0FBQyxDQUEyQiwwQkFBMEI7UUFDekUsYUFBUSxHQUFRLEdBQUcsQ0FBQyxDQUEyQixrQ0FBa0M7UUFDakYsU0FBSSxHQUFRLEdBQUcsQ0FBQyxDQUErQiw4QkFBOEI7UUFDN0UsYUFBUSxHQUFRLEdBQUcsQ0FBQyxDQUEyQiwyQkFBMkI7UUFDMUUsU0FBSSxHQUFRLEdBQUcsQ0FB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Z0JBQ0csS0FBSztzQkFBZCxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVmlld0NoaWxkLCBFbGVtZW50UmVmLCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQsIERvQ2hlY2ssIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IFNxbElucHV0Q29tcG9uZW50IH0gZnJvbSAnLi4vc3FsLWlucHV0L3NxbC1pbnB1dC5jb21wb25lbnQnO1xuaW1wb3J0IHsgU1FMRGF0YVNlcnZpY2UgfSBmcm9tICcuLi9kYXRhLnNlcnZpY2UnO1xuaW1wb3J0IHsgTWF0Q29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvY29yZSc7XG5pbXBvcnQgeyBGb3Jtc01vZHVsZSwgUmVhY3RpdmVGb3Jtc01vZHVsZSwgRm9ybUdyb3VwLCBGb3JtQ29udHJvbCwgVmFsaWRhdG9ycywgRm9ybUJ1aWxkZXIgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwQ2xpZW50SnNvbnBNb2R1bGUsIEh0dHBDbGllbnRNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnc3FsLXVwbG9hZC1mb3JtJyxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW0NvbW1vbk1vZHVsZSwgRm9ybXNNb2R1bGUsIEh0dHBDbGllbnRNb2R1bGUsIFJlYWN0aXZlRm9ybXNNb2R1bGVdLFxuICB0ZW1wbGF0ZVVybDogJy4vc3FsLXVwbG9hZC1mb3JtLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vc3FsLXVwbG9hZC1mb3JtLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBTcWxVcGxvYWRGb3JtQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBEb0NoZWNrLCBPbkNoYW5nZXMsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSAge1xuICBpbmRleDogYW55O1xuICBsYXN0X2lkOiBhbnkgPSAnJztcbiAgbXlPYnMhOiBTdWJzY3JpcHRpb247XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBfaHR0cDogSHR0cENsaWVudCwgcHJpdmF0ZSBfZGF0YVNlcnZpY2U6IFNRTERhdGFTZXJ2aWNlKSB7XG4gICAgICBcbiAgICAgIHRoaXMubXlPYnMgPSB0aGlzLl9kYXRhU2VydmljZS5kYXRhU3ViamVjdC5zdWJzY3JpYmUoZCA9PiB7XG4gICAgICAgIHRoaXMuZGF0YT1kO1xuICAgICAgICB0aGlzLmNvdW50ZXIrKztcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5pZCE9dGhpcy5sYXN0X2lkKSB7XG4gICAgICAgICAgdGhpcy5sYXN0X2lkPXRoaXMuZGF0YS5pZDtcbiAgICAgICAgICB0aGlzLmlkPXRoaXMuZGF0YS5pZDtcbiAgICAgICAgICB0aGlzLm5nQWZ0ZXJWaWV3SW5pdCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmRhdGEuc3VibWl0PT09J1knKSB7XG4gICAgICAgICAgdGhpcy5wb3N0U1FMKCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICB9XG5cbiAgLy8tLSBJbnB1dHNcbiAgQElucHV0KCkgZGF0YTogYW55OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZXByZWNpYXRlZFxuICBASW5wdXQoKSBwYXRoOiBhbnkgPSBcImh0dHBzOi8vbXluYS1kb2NzLmNvbS91cGxvYWQucGhwXCI7ICAgICAgICAgICBcbiAgQElucHV0KCkgaWQ6IGFueSA9ICcwJzsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQcmltYXJ5IGtleSBmb3IgYW4gZXhpc3RpbmcgcmVjb3JkID0gMD1JbnNlcnRcbiAgQElucHV0KCkgdGFibGU6IGFueSA9IFwiZHVhbFwiOyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5hbWUgb2YgdGhlIGJhc2UgdGFibGUuXG4gIEBJbnB1dCgpIGVtYmVkZGVkOiBhbnkgPSBcIk5cIjsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJcyB0aGUgZm9ybSBlbWJlZGRlZCBpbiBhIGxpc3QuXG4gIEBJbnB1dCgpIGNhcmQ6IGFueSA9IFwiWVwiOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTaG93IHRoZSBmb3JtIGluIGEgY2FyZCBZL05cbiAgQElucHV0KCkgY2xvc2FibGU6IGFueSA9IFwiTlwiOyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElzIHRoZSBmb3JtIGNsb3NhYmxlIFkvTlxuICBASW5wdXQoKSBvcGVuOiBhbnkgPSBcIllcIjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG9lcyBhIGNsb3NhYmxlIGZvcm0gc3RhcnQgb3Blbi5cbiAgQElucHV0KCkgY2xhc3M6IGFueSA9IFwiXCI7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENsYXNzIGZvciB0aGUgZm9ybSBjb250YWluZXIuXG4gIEBJbnB1dCgpIHN0eWxlOiBhbnkgPSBcIlwiOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdHlsZSBmb3IgdGhlIGZvcm0gY29udGFpbmVyLlxuICBASW5wdXQoKSB0aXRsZTogYW55ID0gXCJcIjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGl0bGUgb2YgdGhlIGZvcm0uXG4gIEBJbnB1dCgpIGJzX3JvdzogYW55ID0gJ1knOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gWSBtZWFucyBhZGQgYSBib290c3RyYXAgcm93LlxuICBASW5wdXQoKSBic19jb2w6IGFueSA9ICdjb2wtc20tMTIgY29sLWxnLTYgY29sLXhsLTQnOyAgIC8vIFdoYXQgYm9vdHN0cmFwIGNvbHVtbnMuXG4gIEBJbnB1dCgpIGhhbmRsZXI6IGFueSA9ICdkZWZhdWx0JzsgICAgICAgICAgICAgICAgICAgICAgLy8gd2hhdCBoYW5kbGVyIGlzIHVzZWQgdG8gcHJvY2VzcyB0aGUgZm9ybS5cblxuICBAT3V0cHV0KCkgY2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgc2F2ZWQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIGNvdW50ZXI6IG51bWJlciA9IDA7XG5cbiAgc2hvd0Vycm9yQWxlcnQ6IGFueSA9ICdOJztcbiAgZXJyb3JNZXNzYWdlOiBhbnkgPSAnUG9zdCBGYWlsZWQnXG4gIHNob3dTdWNjZXNzQWxlcnQ6IGFueSA9ICdOJztcbiAgbmdPbkluaXQoKTogdm9pZCB7XG5cbiAgfVxuXG4gIHNob3dVcGxvYWQoKSB7XG4gICAgdGhpcy5jaGFuZ2UuZW1pdCgnRE9ORScpXG4gIH1cbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgICAgaWYgKHRoaXMuZW1iZWRkZWQ9PSdZJykge1xuICAgICAgICB0aGlzLmlkPT10aGlzLmRhdGEuaWQ7XG4gICAgICB9XG4gICAgICB0aGlzLl9kYXRhU2VydmljZS5nZXRGb3JtKHRoaXMudGFibGUsIHRoaXMuaWQpLnN1YnNjcmliZSgoZGF0YTphbnkpPT57XG4gICAgICAgIHRoaXMuZGF0YT1kYXRhO1xuICAgICAgICB0aGlzLl9kYXRhU2VydmljZS5wdXNoTm90aWZpY2F0aW9uKHRoaXMuZGF0YSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHBvc3RTUUwoKSB7XG4gICAgdGhpcy5fZGF0YVNlcnZpY2UucG9zdFNRTCh0aGlzLmRhdGEpLnN1YnNjcmliZSgoZGF0YTphbnkpPT57XG4gICAgICBpZiAoZGF0YS5lcnJvcl9jb2RlPT1cIjBcIikgeyBcbiAgICAgICAgdGhpcy5zaG93U3VjY2Vzc0FsZXJ0PSdZJztcbiAgICAgICAgdGhpcy5zaG93RXJyb3JBbGVydD0nTic7XG4gICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlPSdSZWNvcmQgU2F2ZWQnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zaG93U3VjY2Vzc0FsZXJ0PSdOJztcbiAgICAgICAgdGhpcy5zaG93RXJyb3JBbGVydD0nWSc7XG4gICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlPWRhdGEuZXJyb3JfbWVzc2FnZTtcbiAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2U9J1JlY29yZCBTYXZlZCc7XG4gICAgICB9XG4gICAgICB0aGlzLl9kYXRhU2VydmljZS5wdXNoTm90aWZpY2F0aW9uKGRhdGEpO1xuICAgICAgc2V0VGltZW91dCgoKT0+e1xuICAgICAgICB0aGlzLnNob3dFcnJvckFsZXJ0PSdOJztcbiAgICAgICAgdGhpcy5zaG93U3VjY2Vzc0FsZXJ0PSdOJztcbiAgICAgIH0sNTAwMCk7XG5cbiAgICB9KTtcbiAgfVxuICBcbiAgbmdEb0NoZWNrKCk6IHZvaWQge1xuXG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG5cbiAgfVxuXG4gIGZpbGU9bmV3IEZvcm1Db250cm9sKCcnKVxuICBmaWxlX2RhdGE6YW55PScnXG5cbiAgZmlsZUNoYW5nZShpbmRleDogYW55LCBldmVudDogYW55KSB7XG4gICAgXG4gICAgY29uc3QgZmlsZUxpc3Q6IEZpbGVMaXN0ID0gZXZlbnQudGFyZ2V0LmZpbGVzO1xuICAgIGlmIChmaWxlTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgIGxldCBrOiBzdHJpbmc7XG4gICAgICAgIGxldCB2OiBhbnk7XG4gICAgICAgIGNvbnN0IGZpbGUgPSBmaWxlTGlzdFswXTtcbiAgICAgICAgaWYoKGZpbGUuc2l6ZS8xMDQ4NTc2KTw9OClcbiAgICAgICAge1xuICAgICAgICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGZpbGUsIGZpbGUubmFtZSk7XG4gICAgICAgICAgZm9yIChbaywgdl0gb2YgT2JqZWN0LmVudHJpZXModGhpcy5kYXRhKSkge1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKGssdik7ICBcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5maWxlX2RhdGE9Zm9ybURhdGFcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgYWxlcnQoJ0ZpbGUgc2l6ZSBleGNlZWRzIDggTUIuIFBsZWFzZSBjaG9vc2UgbGVzcyB0aGFuIDggTUInKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9XG5cbiAgfVxuXG4gIHVwbG9hZEZpbGUoKVxuICAgIHtcbiAgICAgIHRoaXMuX2h0dHAucG9zdCh0aGlzLnBhdGgsdGhpcy5maWxlX2RhdGEpXG4gICAgICAuc3Vic2NyaWJlKHJlcyA9PiB7XG4gICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpXG4gICAgICB9LCAoZXJyKSA9PiB7XG4gICAgICAvL3NlbmQgZXJyb3IgcmVzcG9uc2VcbiAgICAgIGFsZXJ0KCdlcnJvciBvY2N1cmVkJylcbiAgICB9KTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAgIHRoaXMubXlPYnMudW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuIiwiPGRpdiBjbGFzcz1cImNhcmRcIj5cbiAgICA8ZGl2IGNsYXNzPVwiY2FyZC1oZWFkZXJcIiBzdHlsZT1cIm1hcmdpbi10b3A6IDBweDtcIj5cbiAgICAgICA8aDI+e3sgdGl0bGUgfX08L2gyPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjYXJkLWJvZHlcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtNiBwLTNcIj5cbiAgICAgICAgICAgIDxpbnB1dCBzdHlsZT1cIm1hcmdpbi1sZWZ0OiAyMHB4O1wiIGNsYXNzPVwiYnRuLWRhcmsgYnRuXCIgW2Zvcm1Db250cm9sXT1cImZpbGVcIiAoY2hhbmdlKT1cImZpbGVDaGFuZ2UoaW5kZXgsJGV2ZW50KVwiIHR5cGU9XCJmaWxlXCIgcGxhY2Vob2xkZXI9XCJGaWxlXCI+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLTYgcC0zXCI+XG4gICAgICAgICAgICA8YnV0dG9uIChjbGljayk9XCJzaG93VXBsb2FkKClcIiBjbGFzcz1cImJ0biBidG4tbGlnaHRcIj5cbiAgICAgICAgICAgICAgICBDYW5jZWxcbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgPGJ1dHRvbiBzdHlsZT1cIm1hcmdpbi1sZWZ0OjIwcHg7XCIgKGNsaWNrKT1cInVwbG9hZEZpbGUoKVwiIGNsYXNzPVwiYnRuIGJ0bi1wcmltYXJ5XCI+XG4gICAgICAgICAgICAgICAgVXBsb2FkXG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj4iXX0=